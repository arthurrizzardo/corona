\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{hyperref}
\hypersetup{
            pdftitle={Untitled},
            pdfauthor={Marcelo Avila},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{Untitled}
\author{Marcelo Avila}
\date{17 MÃ¤rz, 2020}

\begin{document}
\maketitle

\hypertarget{load-libraries}{%
\section{load libraries}\label{load-libraries}}

\hypertarget{load-data}{%
\section{load data}\label{load-data}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cat_labels <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"new cases"}\NormalTok{, }\StringTok{"new deaths"}\NormalTok{,}
                \StringTok{"cumulative cases"}\NormalTok{, }\StringTok{"cumulative deaths"}\NormalTok{)}
\NormalTok{df <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{category =} \KeywordTok{factor}\NormalTok{(category, }
                                \DataTypeTok{labels =}\NormalTok{ cat_labels), }
                    \DataTypeTok{continent=}\KeywordTok{countrycode}\NormalTok{(location,}
                                          \DataTypeTok{origin =} \StringTok{"country.name"}\NormalTok{,}
                                          \DataTypeTok{destination =} \StringTok{"continent"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in countrycode(location, origin = "country.name", destination = "continent"): Some values were not matched unambiguously: International, Saint Barthlemy, World
\end{verbatim}

There is data for 151 countries. The last update was on 16 of March

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 8
##   date       location  category   value cca2  pop2020 value_per_100k_~ continent
##   <date>     <chr>     <fct>      <dbl> <chr>   <dbl>            <dbl> <chr>    
## 1 2020-02-25 Afghanis~ new cases      0 AF     3.89e7          0       Asia     
## 2 2020-02-25 Afghanis~ new deaths     0 AF     3.89e7          0       Asia     
## 3 2020-02-25 Afghanis~ cumulativ~     1 AF     3.89e7          0.00257 Asia     
## 4 2020-02-25 Afghanis~ cumulativ~     0 AF     3.89e7          0       Asia     
## 5 2020-02-26 Afghanis~ new cases      0 AF     3.89e7          0       Asia     
## 6 2020-02-26 Afghanis~ new deaths     0 AF     3.89e7          0       Asia
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# for thousand separator for plotting}
\NormalTok{fun_dot <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{format}\NormalTok{(x, }\DataTypeTok{big.mark =} \StringTok{" "}\NormalTok{,}
                              \DataTypeTok{scientific =} \OtherTok{FALSE}\NormalTok{,}
                              \DataTypeTok{decimal.mark =} \StringTok{"."}\NormalTok{)}

\CommentTok{# negative in}
\StringTok{`}\DataTypeTok{%!in%}\StringTok{`}\NormalTok{ <-}\StringTok{ }\KeywordTok{Negate}\NormalTok{(}\StringTok{`}\DataTypeTok{%in%}\StringTok{`}\NormalTok{)}

\CommentTok{# y scale}
\NormalTok{log10_minor_break =}\StringTok{ }\ControlFlowTok{function}\NormalTok{ (...)\{}
  \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{    minx         =}\StringTok{ }\KeywordTok{floor}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{log10}\NormalTok{(x), }\DataTypeTok{na.rm=}\NormalTok{T))}\OperatorTok{-}\DecValTok{1}\NormalTok{;}
\NormalTok{    maxx         =}\StringTok{ }\KeywordTok{ceiling}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{log10}\NormalTok{(x), }\DataTypeTok{na.rm=}\NormalTok{T))}\OperatorTok{+}\DecValTok{1}\NormalTok{;}
\NormalTok{    n_major      =}\StringTok{ }\NormalTok{maxx}\OperatorTok{-}\NormalTok{minx}\OperatorTok{+}\DecValTok{1}\NormalTok{;}
\NormalTok{    major_breaks =}\StringTok{ }\KeywordTok{seq}\NormalTok{(minx, maxx, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{)}
\NormalTok{    minor_breaks =}\StringTok{ }
\StringTok{      }\KeywordTok{rep}\NormalTok{(}\KeywordTok{log10}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DataTypeTok{by=}\DecValTok{1}\NormalTok{)), }\DataTypeTok{times =}\NormalTok{ n_major)}\OperatorTok{+}
\StringTok{      }\KeywordTok{rep}\NormalTok{(major_breaks, }\DataTypeTok{each =} \DecValTok{9}\NormalTok{)}
    \KeywordTok{return}\NormalTok{(}\DecValTok{10}\OperatorTok{^}\NormalTok{(minor_breaks))}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{cumulative-cases-for-selected-countries}{%
\section{Cumulative Cases for Selected
Countries}\label{cumulative-cases-for-selected-countries}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sel_category <-}\StringTok{ "cumulative cases"}  \CommentTok{# new cases, new deaths,}
                                    \CommentTok{# cumulative cases, cumulative deaths}
\NormalTok{selected_countries <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Germany"}\NormalTok{,}
                        \StringTok{"Italy"}\NormalTok{,}
                        \StringTok{"United Kingdom"}\NormalTok{,}
                        \StringTok{"Brazil"}\NormalTok{,}
                        \StringTok{"China"}\NormalTok{,}
                        \StringTok{"Spain"}\NormalTok{,}
                        \StringTok{"South Korea"}\NormalTok{, }
                        \StringTok{"United States"}\NormalTok{)}

\NormalTok{df }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# wrangle}
\StringTok{  }\KeywordTok{filter}\NormalTok{(location }\OperatorTok{%in%}\StringTok{ }\NormalTok{selected_countries, category}\OperatorTok{==}\NormalTok{sel_category) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
    \DataTypeTok{location=}\KeywordTok{fct_reorder2}\NormalTok{(location, date, value),}
    \DataTypeTok{label =} \KeywordTok{ifelse}\NormalTok{(date }\OperatorTok{==}\StringTok{ "2020-02-29"}\NormalTok{, }\CommentTok{#max(date),}
                        \KeywordTok{as.character}\NormalTok{(location), }
                        \OtherTok{NA_character_}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }

\StringTok{  }\CommentTok{# plot}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{date, }\DataTypeTok{y=}\NormalTok{value, }\DataTypeTok{color=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{shape=}\StringTok{"o"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{linetype=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }
\StringTok{  }\CommentTok{# labels}
\StringTok{  }\NormalTok{ggrepel}\OperatorTok{::}\KeywordTok{geom_label_repel}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{label =}\NormalTok{ label),}
                            \DataTypeTok{nudge_x =} \DecValTok{-1}\NormalTok{, }\DataTypeTok{nudge_y =} \DecValTok{1}\OperatorTok{/}\DecValTok{10}\NormalTok{,}
                            \DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\CommentTok{# legend and scales}
\StringTok{  }\KeywordTok{scale_y_log10}\NormalTok{(}\DataTypeTok{name=}\StringTok{"(log scale)"}\NormalTok{, }\DataTypeTok{labels=}\NormalTok{fun_dot, }
                \DataTypeTok{breaks=}\DecValTok{10}\OperatorTok{^}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{),}
                \DataTypeTok{minor_breaks=}\KeywordTok{log10_minor_break}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_breaks =} \StringTok{"1 week"}\NormalTok{, }
               \DataTypeTok{date_labels=}\StringTok{"%d%b"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{ggsci}\OperatorTok{::}\KeywordTok{scale_color_aaas}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{, }
        \DataTypeTok{axis.title.y =} \KeywordTok{element_blank}\NormalTok{()) }
\end{Highlighting}
\end{Shaded}

\includegraphics{corona_international_comparison_files/figure-latex/unnamed-chunk-2-1.pdf}

\hypertarget{normalized-comparison}{%
\section{Normalized comparison}\label{normalized-comparison}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}\OperatorTok{$}\NormalTok{continent }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Asia"     "Europe"   "Africa"   "Americas" "Oceania"  NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}\OperatorTok{$}\NormalTok{category }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.character}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "new cases"         "new deaths"        "cumulative cases" 
## [4] "cumulative deaths"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sel_continent =}\StringTok{ "Asia"}
\NormalTok{sel_category =}\StringTok{ "cumulative cases"}
\NormalTok{threshold <-}\StringTok{ }\DecValTok{10}
\NormalTok{singular_category <-}\StringTok{ }\KeywordTok{scan}\NormalTok{(}\DataTypeTok{text =}\NormalTok{ sel_category, }\DataTypeTok{what =} \StringTok{""}\NormalTok{, }\DataTypeTok{quiet=}\OtherTok{TRUE}\NormalTok{)[}\DecValTok{2}\NormalTok{] }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{substr}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{nchar}\NormalTok{(.)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}

\NormalTok{df }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(category }\OperatorTok{==}\StringTok{ }\NormalTok{sel_category, }
\NormalTok{         continent }\OperatorTok{==}\StringTok{ }\NormalTok{sel_continent) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{group_by}\NormalTok{(location) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(value}\OperatorTok{>=}\NormalTok{threshold) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date_shift=}\DecValTok{0}\OperatorTok{:}\NormalTok{(}\KeywordTok{n}\NormalTok{()}\OperatorTok{-}\DecValTok{1}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\CommentTok{# generate date shifted after threshold}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{(location) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date_shift) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# mutate for legend ordering and ggrepel postioning}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{location=}\KeywordTok{fct_reorder2}\NormalTok{(location, date_shift, value), }
         \CommentTok{# for ggrepel}
         \DataTypeTok{label =} \KeywordTok{ifelse}\NormalTok{(date }\OperatorTok{==}\StringTok{ }\KeywordTok{max}\NormalTok{(date),}
                        \KeywordTok{as.character}\NormalTok{(location), }
                        \OtherTok{NA_character_}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{date_shift, }\DataTypeTok{y=}\NormalTok{value, }\DataTypeTok{colour=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\CommentTok{# geoms}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{linetype=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }
\StringTok{  }\CommentTok{# ggrepel }
\StringTok{  }\NormalTok{ggrepel}\OperatorTok{::}\KeywordTok{geom_label_repel}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{label =}\NormalTok{ label),}
                            \DataTypeTok{nudge_x =} \DecValTok{0}\NormalTok{,}
                            \DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{ }
\StringTok{  }\CommentTok{# legend and scales}
\StringTok{  }\KeywordTok{scale_y_log10}\NormalTok{(}
    \DataTypeTok{name =} \KeywordTok{paste}\NormalTok{(sel_category, }\StringTok{"(log scale)"}\NormalTok{), }\DataTypeTok{labels=}\NormalTok{fun_dot, }
    \DataTypeTok{breaks =} \DecValTok{10}\OperatorTok{^}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{),}
    \DataTypeTok{minor_breaks=}\KeywordTok{log10_minor_break}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_x_continuous}\NormalTok{(}
    \DataTypeTok{name =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"Days past "}\NormalTok{, threshold, }\StringTok{"th "}\NormalTok{, singular_category),}
    \DataTypeTok{breaks =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{1e5}\NormalTok{, }\DecValTok{7}\NormalTok{),}
    \DataTypeTok{minor_breaks =} \DecValTok{1}\OperatorTok{:}\FloatTok{1e3}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_grey}\NormalTok{(}\DataTypeTok{start =} \DecValTok{0}\NormalTok{, }\DataTypeTok{end =} \FloatTok{.3}\NormalTok{) }\OperatorTok{+}
\StringTok{  }
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{, }
        \DataTypeTok{axis.title.y =} \KeywordTok{element_blank}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\CommentTok{#title}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Evolution of novel coronavirus in"}\NormalTok{, sel_continent), }
          \DataTypeTok{subtitle =} \KeywordTok{paste}\NormalTok{(sel_category, }\StringTok{"(log scale)"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{corona_international_comparison_files/figure-latex/unnamed-chunk-4-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{make_plot <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(dta, }\DataTypeTok{sel_category=}\StringTok{"cumulative cases"}\NormalTok{,}
                      \DataTypeTok{sel_continent=}\StringTok{"Europe"}\NormalTok{,}
                      \DataTypeTok{threshold=}\DecValTok{100}\NormalTok{) \{}
  
  \CommentTok{# extract singular form of category}
\NormalTok{  singular_category <-}\StringTok{ }\KeywordTok{scan}\NormalTok{(}\DataTypeTok{text =}\NormalTok{ sel_category, }\DataTypeTok{what =} \StringTok{""}\NormalTok{, }\DataTypeTok{quiet=}\OtherTok{TRUE}\NormalTok{)[}\DecValTok{2}\NormalTok{] }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{substr}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{nchar}\NormalTok{(.)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}
  
\NormalTok{  sel_continent_title <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{length}\NormalTok{(sel_continent)}\OperatorTok{>}\DecValTok{1}\NormalTok{,}
                                \DataTypeTok{yes =} \StringTok{"selected continents"}\NormalTok{,}
                                \DataTypeTok{no =}\NormalTok{ sel_continent)}
\NormalTok{  dta }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{filter}\NormalTok{(category }\OperatorTok{==}\StringTok{ }\NormalTok{sel_category, }
\NormalTok{           continent }\OperatorTok{%in%}\StringTok{ }\NormalTok{sel_continent) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{group_by}\NormalTok{(location) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{filter}\NormalTok{(value}\OperatorTok{>=}\NormalTok{threshold) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date_shift=}\DecValTok{0}\OperatorTok{:}\NormalTok{(}\KeywordTok{n}\NormalTok{()}\OperatorTok{-}\DecValTok{1}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\CommentTok{# generate date shifted after threshold}
\StringTok{    }\KeywordTok{ungroup}\NormalTok{(location) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{arrange}\NormalTok{(date_shift) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\CommentTok{# mutate for legend ordering and ggrepel postioning}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{location=}\KeywordTok{fct_reorder2}\NormalTok{(location, date_shift, value), }
           \CommentTok{# for ggrepel}
           \DataTypeTok{label =} \KeywordTok{ifelse}\NormalTok{(date }\OperatorTok{==}\StringTok{ }\KeywordTok{max}\NormalTok{(date),}
                          \KeywordTok{as.character}\NormalTok{(location), }
                          \OtherTok{NA_character_}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\CommentTok{# plot  }
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{date_shift, }\DataTypeTok{y=}\NormalTok{value, }\DataTypeTok{colour=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{    }\CommentTok{# geoms}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{linetype=}\NormalTok{location)) }\OperatorTok{+}\StringTok{ }
\StringTok{    }
\StringTok{    }\CommentTok{# ggrepel }
\StringTok{    }\NormalTok{ggrepel}\OperatorTok{::}\KeywordTok{geom_label_repel}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{label =}\NormalTok{ label),}
                              \DataTypeTok{nudge_x =} \DecValTok{0}\NormalTok{,}
                              \DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}
\StringTok{    }
\StringTok{    }\CommentTok{# legend and scales}
\StringTok{    }\KeywordTok{scale_y_log10}\NormalTok{(}
      \DataTypeTok{name =} \KeywordTok{paste}\NormalTok{(sel_category, }\StringTok{"(log scale)"}\NormalTok{), }\DataTypeTok{labels=}\NormalTok{fun_dot, }
      \DataTypeTok{breaks =} \DecValTok{10}\OperatorTok{^}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\DecValTok{9}\NormalTok{),}
      \DataTypeTok{minor_breaks=}\KeywordTok{log10_minor_break}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}
      \DataTypeTok{name =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"Days past "}\NormalTok{, threshold, }\StringTok{"th "}\NormalTok{, singular_category),}
      \DataTypeTok{breaks =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{1e5}\NormalTok{, }\DecValTok{7}\NormalTok{),}
      \DataTypeTok{minor_breaks =} \DecValTok{1}\OperatorTok{:}\FloatTok{1e3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_color_grey}\NormalTok{(}\DataTypeTok{start =} \DecValTok{0}\NormalTok{, }\DataTypeTok{end =} \FloatTok{.3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{, }
          \DataTypeTok{axis.title.y =} \KeywordTok{element_blank}\NormalTok{()) }\OperatorTok{+}\StringTok{ }
\StringTok{    }\CommentTok{#title}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Evolution of novel coronavirus in"}\NormalTok{, sel_continent_title), }
            \DataTypeTok{subtitle =} \KeywordTok{paste}\NormalTok{(sel_category, }\StringTok{"(log scale)"}\NormalTok{))}
\NormalTok{\}}

\KeywordTok{make_plot}\NormalTok{(df, }\DataTypeTok{sel_category =} \StringTok{"cumulative deaths"}\NormalTok{,}
          \DataTypeTok{sel_continent =} \KeywordTok{c}\NormalTok{(}\StringTok{"Americas"}\NormalTok{, }\StringTok{"Asia"}\NormalTok{, }\StringTok{"Europe"}\NormalTok{, }\StringTok{"Oceania"}\NormalTok{, }\StringTok{"Africa"}\NormalTok{),}
          \DataTypeTok{threshold =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{corona_international_comparison_files/figure-latex/unnamed-chunk-5-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{categories <-}\StringTok{ }\NormalTok{df}\OperatorTok{$}\NormalTok{category }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.character}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\NormalTok{purrr}\OperatorTok{::}\KeywordTok{set_names}\NormalTok{()}
\NormalTok{continents <-}\StringTok{ }\NormalTok{df}\OperatorTok{$}\NormalTok{continent }\OperatorTok{%>%}\StringTok{ }\KeywordTok{unique}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.character}\NormalTok{() }\OperatorTok{%>%}\StringTok{ }\NormalTok{purrr}\OperatorTok{::}\KeywordTok{set_names}\NormalTok{()}

\NormalTok{plots_categ <-}\StringTok{ }\NormalTok{purrr}\OperatorTok{::}\KeywordTok{map}\NormalTok{(categories, }\OperatorTok{~}\KeywordTok{make_plot}\NormalTok{(df, }\DataTypeTok{sel_category =}\NormalTok{ .x, }\DataTypeTok{threshold =} \DecValTok{25}\NormalTok{))}
\NormalTok{plots_conts <-}\StringTok{ }\NormalTok{purrr}\OperatorTok{::}\KeywordTok{map}\NormalTok{(continents, }\OperatorTok{~}\KeywordTok{make_plot}\NormalTok{(df, }\DataTypeTok{sel_continent =}\NormalTok{ .x, }\DataTypeTok{threshold =} \DecValTok{25}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{Sys.setlocale}\NormalTok{(}\StringTok{"LC_TIME"}\NormalTok{, sys_time_local_old)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "de_DE.UTF-8"
\end{verbatim}

\end{document}
